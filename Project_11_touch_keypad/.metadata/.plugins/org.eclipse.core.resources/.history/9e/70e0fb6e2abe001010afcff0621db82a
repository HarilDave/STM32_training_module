/*
 * keypad.c
 *
 *  Created on: Nov 10, 2025
 *      Author: Himshree
 */

#include "keypad.h"

static uint8_t status_lo = 0;
static uint8_t status_hi = 1;

volatile uint8_t keypad_event = 0;

void KEYPAD_Init(void)
{
}

void KEYPAD_ReadStatus(void)
{
    HAL_I2C_Mem_Read(&hi2c1, KEYPAD_ADDR, 0x02, I2C_MEMADD_SIZE_8BIT, &status_lo, 1, 100);
    HAL_I2C_Mem_Read(&hi2c1, KEYPAD_ADDR, 0x03, I2C_MEMADD_SIZE_8BIT, &status_hi, 1, 100);
}

char KEYPAD_GetKey(void)
{
    if(status_lo & 0x01) return '1';
    if(status_lo & 0x02) return '2';
    if(status_lo & 0x04) return '3';
    if(status_lo & 0x08) return '4';
    if(status_hi & 0x01) return '5';
    if(status_hi & 0x02) return '6';
    if(status_hi & 0x04) return '7';
    if(status_hi & 0x08) return '8';
    if(status_hi & 0x10) return '9';
    if(status_hi & 0x20) return 'A';
    if(status_hi & 0x40) return 'B';
    if(status_hi & 0x80) return 'C';
    return 0;
}

void KEYPAD_SendUART(UART_HandleTypeDef *huart)
{
    char key = KEYPAD_GetKey();
    if(key != 0)
        HAL_UART_Transmit(huart, (uint8_t*)&key, 1, 100);
}

