/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * Copyright (c) 2025 STMicroelectronics.
 * All rights reserved.
 *
 * This software is licensed under terms that can be found in the LICENSE file
 * in the root directory of this software component.
 * If no LICENSE file comes with this software, it is provided AS-IS.
 *
 ******************************************************************************
 */

#include <stdint.h>
#include "STM32_L0538xx.h"
#include "gpio_driver.h"
#include "spi_driver.h"
#include "uart_driver.h"


/*////// GPIO driver
int main(void)
{
    GPIO_Config_t led;

    led.PinNumber = GPIO_PIN_4;
    led.Mode      = GPIO_MODE_OUTPUT;
    led.Pull      = GPIO_NO_PUPD;
    led.Speed     = GPIO_SPEED_LOW;
    led.OType     = GPIO_OTYPE_PP;
    led.AltFunc   = 0;

    GPIO_Init(GPIOB, &led);

    while(1)
    {
        GPIO_TogglePin(GPIOB, GPIO_PIN_4);
        for(volatile uint32_t i = 0; i < 50000; i++);
    }
}
*/
/////////SPI Driver

SPI_Handle_t hspi1;
GPIO_Config_t spi_gpio;

int main(void)
{
    /* ==== SPI GPIO Config (PA5=SCK, PA6=MISO, PA7=MOSI) ==== */
    GPIO_Config_t spi_gpio;

    spi_gpio.Mode = GPIO_MODE_ALTFN;
    spi_gpio.AltFunc = 0;            // AF0 for SPI1
    spi_gpio.Pull = GPIO_NO_PUPD;
    spi_gpio.Speed = GPIO_SPEED_HIGH;
    spi_gpio.OType = GPIO_OTYPE_PP;

    spi_gpio.PinNumber = GPIO_PIN_5; // SCK
    GPIO_Init(GPIOA, &spi_gpio);

    spi_gpio.PinNumber = GPIO_PIN_6; // MISO
    GPIO_Init(GPIOA, &spi_gpio);

    spi_gpio.PinNumber = GPIO_PIN_7; // MOSI
    GPIO_Init(GPIOA, &spi_gpio);

    /* ==== SPI Config ==== */
    SPI_Handle_t hspi1;

    hspi1.pSPIx = SPI1;
    hspi1.Mode = SPI_MODE_MASTER;
    hspi1.Direction = SPI_DIRECTION_2LINES;
    hspi1.DataSize = SPI_DATASIZE_8BIT;
    hspi1.CLKPolarity = SPI_POLARITY_LOW;
    hspi1.CLKPhase = SPI_PHASE_1EDGE;
    hspi1.NSS = SPI_NSS_SOFT;
    hspi1.BaudRatePrescaler = SPI_BAUDRATEPRESCALER_8;
    hspi1.FirstBit = SPI_FIRSTBIT_MSB;

    SPI_Init(&hspi1);

    /* ==== Loopback Test ==== */
    uint8_t tx = 0x55;
    uint8_t rx = 0x00;

    while (1)
    {
        SPI_Transmit(&hspi1, &tx, 1);
        SPI_Receive(&hspi1, &rx, 1);
    }
}

