/*
 * spi_driver.h
 *
 *  Created on: Oct 30, 2025
 *      Author: Himshree
 */

#ifndef SPI_DRIVER_H_
#define SPI_DRIVER_H_

#ifndef SPI_DRIVER_H
#define SPI_DRIVER_H

#include "STM32_L0538xx.h"
#include <stdint.h>

/* SPI mode settings */
#define SPI_MODE_0   0  // CPOL=0, CPHA=0
#define SPI_MODE_1   1  // CPOL=0, CPHA=1
#define SPI_MODE_2   2  // CPOL=1, CPHA=0
#define SPI_MODE_3   3  // CPOL=1, CPHA=1

/* SPI device mode */
#define SPI_DEVICE_MODE_MASTER   1
#define SPI_DEVICE_MODE_SLAVE    0

/* SPI baud rate control (fPCLK / x) */
#define SPI_SCLK_DIV2     0
#define SPI_SCLK_DIV4     1
#define SPI_SCLK_DIV8     2
#define SPI_SCLK_DIV16    3
#define SPI_SCLK_DIV32    4
#define SPI_SCLK_DIV64    5
#define SPI_SCLK_DIV128   6
#define SPI_SCLK_DIV256   7

/* SPI Data Frame Format */
#define SPI_DFF_8BIT   0
#define SPI_DFF_16BIT  1

/* SPI Bus Configurations */
#define SPI_BUS_FULL_DUPLEX   1
#define SPI_BUS_HALF_DUPLEX   2
#define SPI_BUS_SIMPLEX_RX    3

/* SPI NSS Management */
#define SPI_SSM_DISABLE   0
#define SPI_SSM_ENABLE    1

typedef struct
{
    uint8_t DeviceMode;         // Master/Slave
    uint8_t BusConfig;          // Full/Half/Simplex
    uint8_t SclkSpeed;          // Baud rate
    uint8_t DFF;                // 8/16-bit frame
    uint8_t CPOL;               // Clock polarity
    uint8_t CPHA;               // Clock phase
    uint8_t SSM;                // Software slave management
} SPI_Config_t;

typedef struct
{
    SPI_RegDef_t *pSPIx;
    SPI_Config_t  SPIConfig;
} SPI_Handle_t;

/* Peripheral Clock Control */
void SPI_PeriClockControl(SPI_RegDef_t *pSPIx, uint8_t EnOrDi);

/* Initialization & Control */
void SPI_Init(SPI_Handle_t *pSPIHandle);
void SPI_DeInit(SPI_RegDef_t *pSPIx);

void SPI_PeripheralControl(SPI_RegDef_t *pSPIx, uint8_t EnOrDi);

/* Data Send and Receive */
void SPI_SendData(SPI_RegDef_t *pSPIx, uint8_t *pTxBuffer, uint32_t Len);
void SPI_ReceiveData(SPI_RegDef_t *pSPIx, uint8_t *pRxBuffer, uint32_t Len);

/* Status Flag Check */
uint8_t SPI_GetFlagStatus(SPI_RegDef_t *pSPIx, uint32_t FlagName);

/* SPI Flag Macros */
#define SPI_TXE_FLAG   (1 << 1)
#define SPI_RXNE_FLAG  (1 << 0)
#define SPI_BSY_FLAG   (1 << 7)

#endif


#endif /* SPI_DRIVER_H_ */
