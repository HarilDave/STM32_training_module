/*
 * gpio_driver.c
 *
 *  Created on: Oct 30, 2025
 *      Author: Himshree
 */
#include "gpio_driver.h"

void GPIO_Init(GPIO_RegDef_t *port, GPIO_Config_t *config)
{
    if (port == GPIOA) RCC->IOPENR |= (1 << 0);
    else if (port == GPIOB) RCC->IOPENR |= (1 << 1);
    else if (port == GPIOC) RCC->IOPENR |= (1 << 2);
    else if (port == GPIOD) RCC->IOPENR |= (1 << 3);
    else if (port == GPIOH) RCC->IOPENR |= (1 << 7);

    port->MODER &= ~(0x3 << (2 * config->PinNumber));
    port->MODER |= (config->Mode << (2 * config->PinNumber));

    port->OTYPER &= ~(1 << config->PinNumber);
    port->OTYPER |= (config->OType << config->PinNumber);

    port->OSPEEDR &= ~(0x3 << (2 * config->PinNumber));
    port->OSPEEDR |= (config->Speed << (2 * config->PinNumber));

    port->PUPDR &= ~(0x3 << (2 * config->PinNumber));
    port->PUPDR |= (config->Pull << (2 * config->PinNumber));

    if (config->Mode == GPIO_MODE_ALTFN)
    {
        if (config->PinNumber < 8)
        {
            port->AFR[0] &= ~(0xF << (4 * config->PinNumber));
            port->AFR[0] |= (config->AltFunc << (4 * config->PinNumber));
        }
        else
        {
            port->AFR[1] &= ~(0xF << (4 * (config->PinNumber - 8)));
            port->AFR[1] |= (config->AltFunc << (4 * (config->PinNumber - 8)));
        }
    }
}


void GPIO_DeInit(GPIO_TypeDef *port)
{
    if (port == GPIOA)
    {
        RCC->IOPRSTR |= (1 << 0);
        RCC->IOPRSTR &= ~(1 << 0);
    }
    else if (port == GPIOB)
    {
        RCC->IOPRSTR |= (1 << 1);
        RCC->IOPRSTR &= ~(1 << 1);
    }
    else if (port == GPIOC)
    {
        RCC->IOPRSTR |= (1 << 2);
        RCC->IOPRSTR &= ~(1 << 2);
    }
    else if (port == GPIOD)
    {
        RCC->IOPRSTR |= (1 << 3);
        RCC->IOPRSTR &= ~(1 << 3);
    }
    else if (port == GPIOH)
    {
        RCC->IOPRSTR |= (1 << 7);
        RCC->IOPRSTR &= ~(1 << 7);
    }
}

void GPIO_WritePin(GPIO_TypeDef *port, uint8_t pin, uint8_t state)
{
    if (state)
        port->ODR |= (1 << pin);
    else
        port->ODR &= ~(1 << pin);
}

uint8_t GPIO_ReadPin(GPIO_TypeDef *port, uint8_t pin)
{
    return ((port->IDR >> pin) & 0x1);
}

void GPIO_TogglePin(GPIO_TypeDef *port, uint8_t pin)
{
    port->ODR ^= (1 << pin);
}
